manifest {
    mainScript = 'main.nf'
}

// default parameters
params {
    output = 'results'
    max_cores = "20"
    cores = "5"
    memory = 8.GB

    profile = false
    help = false

    // input
    reads = ''
    species = ''
    genome = ''
    annotation = ''
    dge = ''
    index = ''
  
    // parameters
    strand = '0'
    mode = 'single'
    tpm = 1
  
    // folder structure
    output = 'results'
    fastp_dir = '01-Trimming/fastp'
    sortmerna_dir = '02-Sortmerna'
    hisat2_dir = '03-Mapping/hisat2'
    featurecounts_dir = '04-Counting/featurecounts'
    tpm_filter_dir = '05-CountingFilter/TPM'
    annotation_dir = '06-Annotation'
    deseq2_dir = '07-DifferentialExpression/deseq2'
    multiqc_dir = 'Summary'

    // location for autodownload data like databases
    permanentCacheDir = 'nextflow-autodownload-databases'
    // location for storing the conda environments
    condaCacheDir = 'conda'

    // optional profile configurations, mainly necessary for HPC executions
    workdir = "/tmp/nextflow-work-$USER"

    cloudProcess = false
}

profiles {

    standard {
        conda.cacheDir = params.condaCacheDir
        includeConfig 'configs/local.config'
        includeConfig 'configs/conda.config' 
    }
    
    conda {
        conda.cacheDir = params.condaCacheDir
        includeConfig 'configs/conda.config'
    }

    local {
        params.cloudProcess = false
        includeConfig 'configs/local.config'
    }

    slurm {
        params.cloudProcess = true
        includeConfig 'configs/slurm.config' }

    ara {
        params.cloudProcess = true
      	params.workdir = "/beegfs/rna-hta/$USER/work"
  	    params.permanentCacheDir = "/beegfs/rna-hta/nextflow-rnaseq-autodownload/"
        conda.cacheDir = "/beegfs/rna-hta/$USER/nextflow-conda-cache"
        process {
            clusterOptions = '--partition=s_standard,s_fat,b_standard,b_fat'
            withLabel: smallTask { executor = 'local' }
            withLabel: hisat2 { cpus = 48; memory { 70.GB * task.attempt } ; maxRetries = 3; errorStrategy { task.exitStatus in 137..140 ? 'retry' : 'terminate' } }
            withLabel: fastp { cpus = 12; memory = '30 GB' }
            withLabel: subread { cpus = 12; memory = '30 GB' }
            withLabel: sortmerna { cpus = 12; memory = '30 GB' }
        }
        includeConfig 'configs/slurm.config'
        includeConfig 'configs/conda.config' }
 
}
